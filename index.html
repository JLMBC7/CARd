<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindAR Professional Card</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r123/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-three.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #container { width: 100vw; height: 100vh; }
        #loading { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            color: white; font-family: sans-serif; z-index: 10; background: rgba(0,0,0,0.8);
            padding: 20px; border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="loading">Point camera at target...</div>
    <div id="container"></div>

    <script type="module">
        // Helper function to create placeholder icon textures dynamically
        const createIconTexture = (symbol, color) => {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = color;
            ctx.fillRect(0, 0, 128, 128);
            ctx.fillStyle = "white";
            ctx.font = "bold 80px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(symbol, 64, 64);
            return new THREE.CanvasTexture(canvas);
        };

        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
            container: document.querySelector("#container"),
            imageTargetSrc: './targets.mind', 
        });

        const {renderer, scene, camera} = mindarThree;

        // Add some lighting for 3D objects
        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
        scene.add(light);

        const anchor = mindarThree.addAnchor(0);

        const setupScene = () => {
            // 1. Avatar - Upgraded to a 3D Sphere "Head"
            const avatarGroup = new THREE.Group();
            const headGeo = new THREE.SphereGeometry(0.25, 32, 32);
            const headMat = new THREE.MeshPhongMaterial({ color: 0x0077ff });
            const head = new THREE.Mesh(headGeo, headMat);
            
            // Give it some "eyes" so we can see rotation
            const eyeGeo = new THREE.SphereGeometry(0.05, 16, 16);
            const eyeMat = new THREE.MeshBasicMaterial({color: 0xffffff});
            const eyeL = new THREE.Mesh(eyeGeo, eyeMat);
            eyeL.position.set(-0.1, 0.05, 0.2);
            const eyeR = eyeL.clone();
            eyeR.position.x = 0.1;
            
            avatarGroup.add(head, eyeL, eyeR);
            avatarGroup.name = "avatar";
            avatarGroup.position.set(0, 0.3, 0.1);
            anchor.group.add(avatarGroup);

            // 2. Resume Panel - Added a border effect
            const resumeGeo = new THREE.PlaneGeometry(1, 1.4);
            const resumeMat = new THREE.MeshPhongMaterial({ 
                color: 0xffffff, 
                transparent: true, 
                opacity: 0.9,
                side: THREE.DoubleSide 
            });
            const resume = new THREE.Mesh(resumeGeo, resumeMat);
            resume.name = "resume";
            resume.position.set(0, 0, 0);
            anchor.group.add(resume);

            // 3. Interactive Icons
            const icons = [
                { name: 'icon-email', symbol: 'âœ‰', color: '#D44638' },
                { name: 'icon-website', symbol: 'ðŸŒ', color: '#3B5998' },
                { name: 'icon-youtube', symbol: 'â–¶', color: '#FF0000' },
                { name: 'icon-facebook', symbol: 'f', color: '#1877F2' }
            ];

            icons.forEach((data, i) => {
                const geo = new THREE.CircleGeometry(0.12, 32);
                const mat = new THREE.MeshBasicMaterial({ map: createIconTexture(data.symbol, data.color) });
                const icon = new THREE.Mesh(geo, mat);
                icon.name = data.name;
                // Positioned in a row below the resume
                icon.position.set(-0.45 + (i * 0.3), -0.8, 0.05); 
                anchor.group.add(icon);
            });
        };

        anchor.onTargetFound = () => {
            document.getElementById('loading').style.display = 'none';
        };

        const clock = new THREE.Clock();
        
        const updateLogic = () => {
            const time = clock.getElapsedTime();
            const avatar = anchor.group.getObjectByName("avatar");
            const resume = anchor.group.getObjectByName("resume");
            
            if (avatar) {
                // Smooth scale in
                const s = Math.min(1, time * 0.8);
                avatar.scale.set(s, s, s);
                // Float and rotate slightly
                avatar.position.y = 0.4 + Math.sin(time * 2) * 0.05;
                avatar.rotation.y = Math.sin(time) * 0.3;
            }

            if (resume) {
                // Slide in from the left
                const resumeTime = Math.max(0, time - 0.5);
                resume.position.x = Math.max(0, 1.5 - resumeTime * 2);
            }
        };

        window.addEventListener("click", (e) => {
            const mouse = new THREE.Vector2();
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(anchor.group.children, true);

            if (intersects.length > 0) {
                let target = intersects[0].object;
                // Check parent if we clicked an "eye" or part of a group
                const name = target.name || target.parent.name;
                
                if (name === 'icon-website') window.open("https://softmind.tech", '_blank');
                if (name === 'icon-email') window.open("mailto:hello@softmind.tech", '_blank');
                if (name === 'icon-youtube') alert("YouTube Clicked!");
                if (name === 'icon-facebook') alert("Facebook Clicked!");
            }
        });

        const start = async () => {
            setupScene();
            await mindarThree.start();
            renderer.setAnimationLoop(() => {
                updateLogic();
                renderer.render(scene, camera);
            });
        }
        start();
    </script>
</body>
</html>